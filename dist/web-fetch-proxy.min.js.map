{"version":3,"file":"web-fetch-proxy.min.js","sources":["../node_modules/@babel/runtime/helpers/readOnlyError.js","../src/index.js"],"sourcesContent":["function _readOnlyError(name) {\n  throw new TypeError(\"\\\"\" + name + \"\\\" is read-only\");\n}\nmodule.exports = _readOnlyError, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/*\n * description: proxying fetch function in browser\n * author: txiejun\n * email: txiejun@126.com\n */\n\nvar prototype = 'prototype'\n\nfunction Handler(resolve, reject) {\n  this._resolve = resolve\n  this._reject = reject\n}\n\nHandler[prototype] = Object.create({\n  resolve: function resolve(res) {\n    this._resolve && this._resolve(res.response)\n  },\n  reject: function reject(err) {\n    this._reject && this._reject(err.error)\n  }\n})\n\nfunction makeHandler(next) {\n  function sub(resolve, reject) {\n    Handler.call(this, resolve, reject)\n  }\n\n  sub[prototype] = Object.create(Handler[prototype])\n  sub[prototype].next = next\n  return sub\n}\n\nfunction proxyFetch(proxy, win) {\n  const onRequest = proxy.onRequest\n  const onResponse = proxy.onResponse\n  const onError = proxy.onError\n  const originalFetch = win.fetch\n  if (!originalFetch) {\n    console.error(\"fetch is null\")\n    return {}\n  }\n\n  /**\n   * @param url A URL string or a Request object\n   * @param init config\n   */\n  win.fetch = function (url, init) {\n    let config = { url, init }\n    return new Promise((resolve, reject) => {\n      let RequestHandler = makeHandler(function (cfg) {\n        cfg = cfg || config;\n        callFetch(cfg)\n      })\n      let ResponseHandler = makeHandler(function (res) {\n        this.resolve(res)\n      })\n      let ErrorHandler = makeHandler(function (err) {\n        this.reject(err)\n      })\n      const callFetch = (config) => {\n        originalFetch.apply(this, [config.url, config.init]).then((response) => {\n          let handler = new ResponseHandler(resolve, reject)\n          let ret = {\n            config: config,\n            response: response,\n          }\n          if (!onResponse) {\n            return handler.resolve(ret)\n          }\n          onResponse(ret, handler)\n        }).catch((error) => {\n          let handler = new ErrorHandler(resolve, reject)\n          let err = { config: config, error: error }\n          if (onError) {\n            onError(err, handler)\n          } else {\n            handler.next(err)\n          }\n        })\n      }\n      if (onRequest) {\n        onRequest(config, new RequestHandler(resolve, reject))\n      }\n      else {\n        callFetch(config)\n      }\n    })\n  }\n\n  function unProxy() {\n    win.fetch = originalFetch\n    originalFetch = undefined\n  }\n\n  return {\n    originalFetch,\n    unProxy\n  }\n}\n\nexport default function webFetchProxy(proxy, win) {\n  win = win || window;\n  return proxyFetch(proxy, win)\n}"],"names":["module","exports","name","TypeError","__esModule","Handler","resolve","reject","this","_resolve","_reject","makeHandler","next","sub","call","Object","create","res","response","err","error","proxy","win","onRequest","onResponse","onError","originalFetch","fetch","url","init","_this","config","Promise","RequestHandler","cfg","callFetch","ResponseHandler","ErrorHandler","apply","then","handler","ret","unProxy","_readOnlyError","console","proxyFetch","window"],"mappings":";;;;;;+TAGAA,EAAAC,QAHA,SAAwBC,GACtB,MAAM,IAAIC,UAAU,IAAOD,EAAO,mBAEHF,EAAyBC,QAAAG,YAAG,EAAMJ,EAAOC,QAAiB,QAAID,EAAOC,gGCKtG,SAASI,EAAQC,EAASC,GACxBC,KAAKC,SAAWH,EAChBE,KAAKE,QAAUH,EAYjB,SAASI,EAAYC,GACnB,SAASC,EAAIP,EAASC,GACpBF,EAAQS,KAAKN,KAAMF,EAASC,GAK9B,OAFAM,EAAa,UAAIE,OAAOC,OAAOX,EAAiB,WAChDQ,EAAa,UAAED,KAAOA,EACfC,SAhBTR,EAAiB,UAAIU,OAAOC,OAAO,CACjCV,QAAS,SAAiBW,GACxBT,KAAKC,UAAYD,KAAKC,SAASQ,EAAIC,WAErCX,OAAQ,SAAgBY,GACtBX,KAAKE,SAAWF,KAAKE,QAAQS,EAAIC,UAkFtB,SAAuBC,EAAOC,GAE3C,OAtEF,SAAoBD,EAAOC,GACzB,IAAMC,EAAYF,EAAME,UAClBC,EAAaH,EAAMG,WACnBC,EAAUJ,EAAMI,QAChBC,EAAgBJ,EAAIK,MAC1B,OAAKD,GASLJ,EAAIK,MAAQ,SAAUC,EAAKC,GAAM,IAAAC,EAAAtB,KAC3BuB,EAAS,CAAEH,IAAAA,EAAKC,KAAAA,GACpB,OAAO,IAAIG,SAAQ,SAAC1B,EAASC,GAC3B,IAAI0B,EAAiBtB,GAAY,SAAUuB,GAEzCC,EADAD,EAAMA,GAAOH,MAGXK,EAAkBzB,GAAY,SAAUM,GAC1CT,KAAKF,QAAQW,MAEXoB,EAAe1B,GAAY,SAAUQ,GACvCX,KAAKD,OAAOY,MAERgB,EAAY,SAACJ,GACjBL,EAAcY,MAAMR,EAAM,CAACC,EAAOH,IAAKG,EAAOF,OAAOU,MAAK,SAACrB,GACzD,IAAIsB,EAAU,IAAIJ,EAAgB9B,EAASC,GACvCkC,EAAM,CACRV,OAAQA,EACRb,SAAUA,GAEZ,IAAKM,EACH,OAAOgB,EAAQlC,QAAQmC,GAEzBjB,EAAWiB,EAAKD,MAChB,OAAO,SAACpB,GACR,IAAIoB,EAAU,IAAIH,EAAa/B,EAASC,GACpCY,EAAM,CAAEY,OAAQA,EAAQX,MAAOA,GAC/BK,EACFA,EAAQN,EAAKqB,GAEbA,EAAQ5B,KAAKO,OAIfI,EACFA,EAAUQ,EAAQ,IAAIE,EAAe3B,EAASC,IAG9C4B,EAAUJ,OAUT,CACLL,cAAAA,EACAgB,QAPF,WACEpB,EAAIK,MAAQD,EACaiB,EAAA,qBArDzBC,QAAQxB,MAAM,iBACP,IA+DFyB,CAAWxB,EADlBC,EAAMA,GAAOwB"}